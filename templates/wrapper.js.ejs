(function () {
    var <%= namespace %> = {
        modules: {},
        req: function (dirname) {
            dirname = dirname.replace(/\/$/, '');
            return function (modName) {
                var p = [dirname, modName].join('/');
                p = p.replace(/([\w]+|^\.)\/\.\.\//g, '');
                p = p.replace(/\.\//g, '');
                return <%= namespace %>.modules[p];
            };
        },
    };

<% mods.split(/\n/).forEach(function (line) { %>
    <%- line %><% }); %>
})();
